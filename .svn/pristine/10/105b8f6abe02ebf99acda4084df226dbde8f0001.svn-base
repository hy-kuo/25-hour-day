// JavaScript Document

onload = function(){
	initUser();
	
}



var initUser = function(){
		//user to register			
		var registerBtn = document.getElementById('register');
		registerBtn.onclick = function(){
				location.href = 'http://25-hour-day.appspot.com/register.html';
				//end of user to regiser
				}

				// handle login
				var loginForm = document.getElementById('login-form'); 
				loginForm.onsubmit =  function(){
				var id = document.getElementById('id').value;
				var password = document.getElementById('password').value;
				
				
				ajaxRequest ('POST',encodeURI('login'), {'Content-Type': 'application/json;charset=UTF-8'}, 
				'{' + '"id": "' + id + '", "password" :"' + password +'"' + '}',
				function(status,headers, body){//success callback
				
			
				
				var login = document.getElementById('login');
				addClass(login,'content-hidden');

				var logout = document.getElementById('logout');
					removeClass(logout, 'content-hidden');								
					var threeButton = document.getElementById('threeButton');
					removeClass(threeButton, 'content-hidden');
					checklogin();

					
				},function(status,headers, body){//error callback
					alert('Id or password is wrong!');
					return;
				},null);
				return false;
				
				}
				//end of login
				
				//start logout
				var logoutForm = document.getElementById('logout-form');
				logoutForm.onsubmit = function(){
					ajaxRequest('PUT', encodeURI('login'), null, null
							, function(status, headers, body) { //success
								
								var logout = document.getElementById('logout');
									addClass(logout, 'content-hidden');		
									var login = document.getElementById('login');
									removeClass(login,'content-hidden');
									var threeButton = document.getElementById('threeButton');
									addClass(threeButton, 'content-hidden');

							}, function(status, headers, body) { //error
									alert('ERROR!!!!');				
							}, null);
					checklogin();

					return false;
				}
				//end logout
				checklogin();

				

}
 
var checklogin = function(){
		ajaxRequest('GET', encodeURI('login'), {'Accept': 'application/json;'}, null
			, function(status, headers, body) { //success
				var user = eval('(' + body + ')');
				initRecommendationButton(user);
				initCreateButton(user);
				var login = document.getElementById('login');
				addClass(login,'content-hidden');

				var logout = document.getElementById('logout');
					removeClass(logout, 'content-hidden');	
					var threeButton = document.getElementById('threeButton');
					removeClass(threeButton, 'content-hidden');
			}, function(status, headers, body) { //error
				getGuestActivityList();
				var login = document.getElementById('login');
				removeClass(login,'content-hidden');
				
			}, null);
	
	}

var initCreateButton = function(user){
	var createButton = document.getElementById('newActivity');
	createButton.onclick = function(){
		var createForm = document.getElementById('crateActivity');
		removeClass(createForm, 'content-hidden');
		var timeLine = document.getElementById('timeline_img');
		addClass(timeLine, 'content-hidden');
	}
	var createForm = document.getElementById('crateActivity');
	createForm.onsubmit = function(){
		//escape(formEl.elements['mail-title'].value)
		var characteristic = new Array(5);
		
		for(var j=0; j<5; j++){
		var ch = document.getElementsByName('characteristic' + j);
			
			for(var i=0; i<5; i++){
				if(ch[i].checked) characteristic[j] = ch[i].value;
				else characteristic[j] = 0;
			}
		}
		ajaxRequest ('POST',encodeURI('activity'), {'Content-Type': 'application/json;charset=UTF-8'}, 
				'{ "title":"' + escape(createForm.elements['activity-title'].value) + '",' +
			'"content":"' + escape(createForm.elements['activity-text'].value) + '",' +
			'"founder":"' + user.id + '",' +
			'"characteristic":' + '[' + characteristic + ']'  + ',' +
			'"scoredTimes":' +1 +
			'}',
				function(status,headers, body){//success callback
					var login = document.getElementById('login');
					addClass(login,'content-hidden');
					var createForm = document.getElementById('crateActivity');
					removeClass(createForm, 'content-hidden');
					var timeLine = document.getElementById('timeline_img');
					addClass(timeLine, 'content-hidden');
					alert('Thanks for your idea !');
					location.href='http://25-hour-day.appspot.com/home.html';
				},function(status,headers, body){//error callback
					alert('Something is wrong!');
					return;
				},null);
				return false;
				}
	
	}


var initRecommendationButton = function(user){
		var RecommendationButton = document.getElementById('someIdeas');
		RecommendationButton.onclick = function(){
		ajaxRequest('GET', encodeURI('recommendation/'+ user.id), {'Accept': 'application/json;'}, null
			, function(status, headers, body) {//success
				
			}, function(status, headers, body){//error
				alert('get recommendations list error!');
			},null);
		return false;
		}

}


var getGuestActivityList = function(){
	ajaxRequest('GET', encodeURI('activity'), {'Accept': 'application/json;'}, null
			, function(status, headers, body) {//success
				
			}, function(status, headers, body){//error
				alert('get guest activity list error!');
			},null);
		return false;
	}
